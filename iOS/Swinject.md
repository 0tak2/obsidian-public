## 개요

현재 진행 중인 개인프로젝트를 출시하고 보니 욕심이 많이 생긴다.

1. 뷰 컨트롤러가 너무 커졌다.
    - 며칠만 코드를 안봐도 다시 볼 때 파악할 시간이 좀 필요하다.
	- Extension으로 나누어 뷰 컨트롤러를 수평적으로 분할하면서 짰지만, 오히려 하나의 컴포넌트에 대한 코드가 여러 파일로 쪼개지다 보니 수정해야할 메서드가 어디에 있는지 찾는데 시간이 더 걸린다.
2. 이런 일이 있으니 아키텍쳐 레벨에서의 개선 필요성을 많이 느꼈다. 프로젝트는 점점 더 확장될 것이므로, 레이어를 나누어야 위와 같은 불편이 줄어들 것이다.
3. 막상 무턱대고 MVVM이니 클린 아키텍쳐니 도입하려 보니, 사소한 변경에도 기존 기능에 장애가 생겼던 이전의 몇몇 케이스가 떠올랐다.
4. 장대한 욕심의 시작에는 테스트 코드가 필요하다. 리팩토링하고, 테스트하고, 안심하고, ... 적어도 이 사이클을 자신있게 돌릴 수 있어야 시작할 수 있다.
5. 리팩토링을 위한 테스트이므로 통합 테스트가 아니라 핵심 컴포넌트에 대한 단위 테스트가 필요하다. 그러나 지금 구현 상, 각종 컴포넌트끼리의 결합도가 매우 강해서 바로 테스트를 작성할 수가 없다.
	- 이런 코드 `let component = Component.shared`가 너무 많다.
6. 컴포넌트끼리의 결합도를 낮춰야 한다. DI가 필요하다.

View - ViewController - Repository - ...  
각 컴포넌트가 직접 의존 컴포넌트의 객체를 생성해 소유하는 방식은 단순하지만 결합도를 높인다. 이런 의존 관계를 느슨해지도록 끊으려면 외부에서 의존하는 컴포넌트를 주입받도록 리팩토링하면 된다. (Dependency Injection)

당연히 주입은 외부에서 누군가가 해줘야 한다. 일반적으로 여러 언어 진영과는 상관없이 다양한 프레임워크나 DI 라이브러리에는 공통적으로 Container가 있다. 이 Container에 각종 컴포넌트의 객체를 생성해 모아두고, 여기서에서 원하는 객체에 가지고 있는 다른 객체를 주입해준다.  
우리가 작성해둔 코드는 의존성 해결에 대한 책임에서 손을 떼고, 외부의 컨테이너가 이 책임을 대신하는 것이다. (Inversion of control)

백엔드 개발을 할 때에는 Spring에서 이 작업을 너무 간단히 해줘서 목적과 필요성을 잘 체감하지 못했었다. 모바일 개발을 시작해보니 너무나도 필요성을 느낀다. 공부가 되었다.

DI 라이브러리로 [Swinject](https://github.com/Swinject/Swinject)를 선택했다. 더 큰 프레임워크인 [TCACoordinators](https://github.com/johnpatrickmorgan/TCACoordinators)도 있고, [swift-dependencies](https://github.com/pointfreeco/swift-dependencies)라는 라이브러리도 있고 선택지가 많았다. TCACoordinators는 단순 DI 라이브러리가 아니라 전반적인 아키텍쳐를 제공하는 규모있는 프레임워크여서 부담이 좀 있었다. swift-dependencies는 평이 좋았지만, Swinject가 스토리보드를 사용하는 경우에도 편리하게 DI가 되어서 선택했다.



